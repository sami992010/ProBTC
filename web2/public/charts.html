<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ProBTC â€” Charts & Trading</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: #0a0a0a;
      --text-color: #fff;
      --card-bg: #111;
      --accent: #ff6600;
      --positive: #4caf50;
      --negative: #e53935;
    }
    [data-theme="light"] {
      --bg-color: #f2f2f2;
      --text-color: #111;
      --card-bg: #fff;
      --accent: #ff6600;
      --positive: #2e7d32;
      --negative: #c62828;
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth;
    }
    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      line-height: 1.6;
      padding-top: 70px;
      transition: background-color 0.3s, color 0.3s;
    }
    nav {
      position: fixed;
      top: 0; width: 100%;
      background: var(--card-bg);
      border-bottom: 2px solid var(--accent);
      padding: 1rem 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 999;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    nav .logo {
      font-weight: 700;
      font-size: 1.75rem;
      color: var(--accent);
      user-select: none;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 2rem;
    }
    nav ul li a {
      color: var(--text-color);
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      transition: background-color 0.3s, color 0.3s;
    }
    nav ul li a:hover,
    nav ul li a.active {
      background-color: var(--accent);
      color: #000;
      box-shadow: 0 0 8px var(--accent);
    }
    .theme-toggle {
      background: transparent;
      border: 2px solid var(--accent);
      color: var(--accent);
      font-weight: 600;
      padding: 0.4rem 0.8rem;
      border-radius: 25px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s, color 0.3s;
    }
    .theme-toggle:hover {
      background-color: var(--accent);
      color: #000;
      box-shadow: 0 0 8px var(--accent);
    }
    main {
      max-width: 1200px;
      margin: 2rem auto 4rem;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 1.5rem;
    }
    .market-section {
      grid-column: 1 / -1;
    }
    h1 {
      color: var(--accent);
      margin-bottom: 1rem;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      background: var(--card-bg);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(255, 102, 0, 0.3);
    }
    thead tr {
      background: var(--accent);
      color: #000;
      font-weight: 700;
      font-size: 1rem;
      text-align: left;
    }
    thead th, tbody td {
      padding: 0.7rem 1rem;
      border-bottom: 1px solid #333;
    }
    tbody tr:hover {
      background: rgba(255, 102, 0, 0.1);
      cursor: pointer;
    }
    tbody tr.active {
      background: rgba(255, 102, 0, 0.2);
    }
    tbody tr td.positive {
      color: var(--positive);
      font-weight: 600;
    }
    tbody tr td.negative {
      color: var(--negative);
      font-weight: 600;
    }
    canvas {
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(255, 102, 0, 0.3);
      display: block;
      margin: 1rem auto;
      max-width: 100%;
      height: 400px;
    }
    .export-btn {
      display: block;
      margin: 1rem auto;
      background: var(--accent);
      color: #000;
      font-weight: 700;
      border: none;
      border-radius: 25px;
      padding: 0.7rem 2rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .export-btn:hover {
      background: #ff8533;
    }

    /* Trading Panel Styles */
    .trading-panel {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 0 10px rgba(255, 102, 0, 0.3);
      height: fit-content;
      position: sticky;
      top: 90px;
    }
    .trading-panel h2 {
      color: var(--accent);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .coin-selector {
      margin-bottom: 1.5rem;
    }
    .coin-selector select {
      width: 100%;
      padding: 0.75rem;
      background: var(--bg-color);
      border: 1px solid var(--accent);
      color: var(--text-color);
      border-radius: 6px;
      font-size: 1rem;
    }
    .price-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(255, 102, 0, 0.1);
      border-radius: 6px;
    }
    .current-price {
      font-size: 1.5rem;
      font-weight: 700;
    }
    .price-change {
      font-size: 1rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }
    .price-change.positive {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--positive);
    }
    .price-change.negative {
      background-color: rgba(229, 57, 53, 0.2);
      color: var(--negative);
    }
    .trade-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .form-group label {
      font-size: 0.9rem;
      color: #aaa;
    }
    .form-group input {
      padding: 0.75rem;
      background: var(--bg-color);
      border: 1px solid var(--accent);
      color: var(--text-color);
      border-radius: 6px;
      font-size: 1rem;
    }
    .trade-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .trade-btn {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1rem;
    }
    .buy-btn {
      background: var(--positive);
      color: #000;
    }
    .sell-btn {
      background: var(--negative);
      color: white;
    }
    .trade-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
      }
      .trading-panel {
        order: -1;
        margin-bottom: 2rem;
        position: static;
      }
    }
  </style>
</head>
<body data-theme="dark">

  <nav>
    <div class="logo">ProBTC</div>
    <ul>
      <li><a href="home.html">Home</a></li>
      <li><a href="account-types.html">Account Types</a></li>
      <li><a href="contact.html">Contact Us</a></li>
      <li><a href="about.html">About Us</a></li>
      <li><a href="charts.html" class="active">Charts</a></li>
    </ul>
    <button class="theme-toggle" aria-label="Toggle Light/Dark Theme">Toggle Theme</button>
  </nav>

  <main>
    <div class="market-section">
      <h1>Live Crypto Market Charts</h1>
      <table aria-label="Cryptocurrency market data" role="grid">
        <thead>
          <tr>
            <th>Coin</th>
            <th>Price</th>
            <th>24h Change</th>
            <th>Market Cap</th>
            <th>24h Volume</th>
          </tr>
        </thead>
        <tbody id="coins-tbody">
          <tr><td colspan="5" style="text-align:center; padding: 2rem;">Loading data...</td></tr>
        </tbody>
      </table>

      <canvas id="cryptoChart" aria-label="Cryptocurrency price chart" role="img" width="900" height="400"></canvas>

      <button class="export-btn" aria-label="Export chart data as CSV">Export Data</button>
    </div>

    <!-- Trading Panel -->
    <div class="trading-panel">
      <h2>Trade Crypto</h2>

      <div class="coin-selector">
        <select id="tradeCoinSelect">
          <option value="bitcoin">Bitcoin (BTC)</option>
          <option value="ethereum">Ethereum (ETH)</option>
          <option value="ripple">Ripple (XRP)</option>
          <option value="litecoin">Litecoin (LTC)</option>
          <option value="cardano">Cardano (ADA)</option>
        </select>
      </div>

      <div class="price-display">
        <span class="current-price" id="tradeCurrentPrice">$0.00</span>
        <span class="price-change" id="tradePriceChange">0.00%</span>
      </div>

      <div class="trade-form">
        <div class="form-group">
          <label for="tradeAmount">Amount</label>
          <input type="number" id="tradeAmount" placeholder="0.00" min="0" step="0.0001">
        </div>

        <div class="form-group">
          <label for="tradePrice">Price (USD)</label>
          <input type="number" id="tradePrice" placeholder="0.00" min="0" step="0.01">
        </div>

        <div class="form-group">
          <label for="tradeTotal">Total (USD)</label>
          <input type="number" id="tradeTotal" placeholder="0.00" readonly>
        </div>

        <div class="trade-buttons">
          <button class="trade-btn buy-btn" id="tradeBuyBtn">Buy</button>
          <button class="trade-btn sell-btn" id="tradeSellBtn">Sell</button>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // DOM Elements
    const coinsTbody = document.getElementById('coins-tbody');
    const ctx = document.getElementById('cryptoChart').getContext('2d');
    const trackedCoins = ['bitcoin', 'ethereum', 'ripple', 'litecoin', 'cardano', 'polkadot', 'dogecoin', 'binancecoin', 'solana', 'avalanche'];
    const currencyCode = 'USD';
    const currencyLocale = 'en-US';

    // Trading panel elements
    const tradeCoinSelect = document.getElementById('tradeCoinSelect');
    const tradeCurrentPriceEl = document.getElementById('tradeCurrentPrice');
    const tradePriceChangeEl = document.getElementById('tradePriceChange');
    const tradeAmountInput = document.getElementById('tradeAmount');
    const tradePriceInput = document.getElementById('tradePrice');
    const tradeTotalInput = document.getElementById('tradeTotal');
    const tradeBuyBtn = document.getElementById('tradeBuyBtn');
    const tradeSellBtn = document.getElementById('tradeSellBtn');

    // Chart data
    let chartLabels = [];
    let datasets = trackedCoins.map(coin => ({
      label: coin.charAt(0).toUpperCase() + coin.slice(1),
      data: [],
      borderColor: getRandomColor(),
      backgroundColor: 'transparent',
      tension: 0.2,
    }));

    // Market data cache
    let marketDataCache = {};

    function getRandomColor() {
      const colors = ['#ff6600', '#ff8533', '#ffa64d', '#ffb366', '#ff9933', '#ff8000', '#e67300', '#cc6600', '#b35900', '#994d00'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    const cryptoChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: datasets
      },
      options: {
        responsive: true,
        interaction: {
          mode: 'nearest',
          intersect: false
        },
        plugins: {
          legend: {
            display: true,
            position: 'bottom'
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Time' }
          },
          y: {
            title: { display: true, text: 'Price (USD)' },
            beginAtZero: false
          }
        }
      }
    });

    async function fetchCryptoData() {
      try {
        const response = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=${currencyCode}&ids=${trackedCoins.join(',')}&order=market_cap_desc&per_page=10&page=1&sparkline=false`);
        const data = await response.json();
        if (!Array.isArray(data)) throw new Error('Invalid data format');

        // Clear previous data
        coinsTbody.innerHTML = '';
        const now = new Date();
        const timeLabel = now.toLocaleTimeString(currencyLocale, { hour: '2-digit', minute: '2-digit' });
        chartLabels.push(timeLabel);
        if(chartLabels.length > 20) chartLabels.shift();

        // Clear previous chart data
        datasets.forEach(ds => {
          if(ds.data.length >= 20) ds.data.shift();
        });

        // Update market data cache
        data.forEach(coinData => {
          marketDataCache[coinData.id] = coinData;
        });

        // Update trading panel if selected coin exists
        updateTradingPanel();

        data.forEach((coinData, idx) => {
          // Add coin row
          const tr = document.createElement('tr');
          tr.addEventListener('click', () => {
            // Set this coin as active in trading panel
            tradeCoinSelect.value = coinData.id;
            updateTradingPanel();
          });

          // Coin name + logo
          const coinCell = document.createElement('td');
          const img = document.createElement('img');
          img.src = coinData.image;
          img.alt = `${coinData.name} logo`;
          img.style.width = '20px';
          img.style.height = '20px';
          img.style.marginRight = '8px';
          img.style.borderRadius = '50%';
          coinCell.appendChild(img);
          const spanName = document.createElement('span');
          spanName.textContent = coinData.name;
          coinCell.appendChild(spanName);
          tr.appendChild(coinCell);

          // Price
          const priceCell = document.createElement('td');
          priceCell.textContent = coinData.current_price.toLocaleString(currencyLocale, { style: 'currency', currency: currencyCode });
          tr.appendChild(priceCell);

          // 24h Change
          const changeCell = document.createElement('td');
          changeCell.textContent = coinData.price_change_percentage_24h.toFixed(2) + '%';
          changeCell.className = coinData.price_change_percentage_24h >= 0 ? 'positive' : 'negative';
          tr.appendChild(changeCell);

          // Market Cap
          const mcapCell = document.createElement('td');
          mcapCell.textContent = coinData.market_cap.toLocaleString(currencyLocale, { style: 'currency', currency: currencyCode, maximumFractionDigits: 0 });
          tr.appendChild(mcapCell);

          // 24h Volume
          const volCell = document.createElement('td');
          volCell.textContent = coinData.total_volume.toLocaleString(currencyLocale, { style: 'currency', currency: currencyCode, maximumFractionDigits: 0 });
          tr.appendChild(volCell);

          coinsTbody.appendChild(tr);

          // Add data point for chart
          datasets[idx].data.push(coinData.current_price);
        });

        cryptoChart.update();
      } catch (error) {
        console.error('Error fetching crypto data:', error);
        coinsTbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color: var(--accent); padding: 2rem;">Failed to load data. Please try again later.</td></tr>`;
      }
    }

    // Update trading panel with current coin data
    function updateTradingPanel() {
      const selectedCoin = tradeCoinSelect.value;
      const coinData = marketDataCache[selectedCoin];

      if (coinData) {
        tradeCurrentPriceEl.textContent = coinData.current_price.toLocaleString(currencyLocale, {
          style: 'currency',
          currency: currencyCode
        });

        const change = coinData.price_change_percentage_24h;
        tradePriceChangeEl.textContent = change.toFixed(2) + '%';
        tradePriceChangeEl.className = change >= 0 ? 'price-change positive' : 'price-change negative';

        // Update price input
        tradePriceInput.value = coinData.current_price.toFixed(2);
        calculateTradeTotal();
      }
    }

    // Calculate trade total
    function calculateTradeTotal() {
      const amount = parseFloat(tradeAmountInput.value) || 0;
      const price = parseFloat(tradePriceInput.value) || 0;
      tradeTotalInput.value = (amount * price).toFixed(2);
    }

    // Execute trade
    function executeTrade(type) {
      const coin = tradeCoinSelect.options[tradeCoinSelect.selectedIndex].text;
      const amount = parseFloat(tradeAmountInput.value);
      const price = parseFloat(tradePriceInput.value);

      if (!amount || amount <= 0) {
        alert('Please enter a valid amount');
        return;
      }

      if (!price || price <= 0) {
        alert('Please enter a valid price');
        return;
      }

      const total = amount * price;
      alert(`${type} order placed for ${amount} ${coin} at $${price.toFixed(2)} each (Total: $${total.toFixed(2)})`);

      // Reset form
      tradeAmountInput.value = '';
      tradePriceInput.value = marketDataCache[tradeCoinSelect.value]?.current_price.toFixed(2) || '0.00';
      tradeTotalInput.value = '0.00';
    }

    // Event listeners
    tradeAmountInput.addEventListener('input', calculateTradeTotal);
    tradePriceInput.addEventListener('input', calculateTradeTotal);
    tradeCoinSelect.addEventListener('change', updateTradingPanel);
    tradeBuyBtn.addEventListener('click', () => executeTrade('Buy'));
    tradeSellBtn.addEventListener('click', () => executeTrade('Sell'));

    // Initial fetch
    fetchCryptoData();
    setInterval(fetchCryptoData, 30000);

    // Export CSV
    const exportBtn = document.querySelector('.export-btn');
    exportBtn.addEventListener('click', () => {
      if(chartLabels.length === 0) return alert('No data to export yet.');
      let csv = 'Time,' + trackedCoins.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(',') + '\n';
      for(let i=0; i < chartLabels.length; i++) {
        let row = chartLabels[i] + ',';
        row += datasets.map(ds => ds.data[i]?.toFixed(2) || '').join(',');
        csv += row + '\n';
      }
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'crypto_data.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // Theme toggle & persistence
    const themeToggleBtn = document.querySelector('.theme-toggle');
    themeToggleBtn.addEventListener('click', () => {
      const currentTheme = document.body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', savedTheme);

    // Highlight active nav link
    const links = document.querySelectorAll('nav ul li a');
    links.forEach(link => {
      if (link.href === location.href) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  </script>
</body>
</html>